<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Manager</title>
    <style>
        /* Estilos CSS */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2a6f2a;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 20px;
            color: #555;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #333;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .config-item, .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
        }
        .player-list {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .player-item:last-child {
            border-bottom: none;
        }
        .player-chips {
            font-weight: bold;
            color: #007bff;
            min-width: 60px;
            text-align: right;
        }
        .result-player {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 1.1em;
        }
        .gain {
            color: #28a745;
            font-weight: bold;
        }
        .loss {
            color: #dc3545;
            font-weight: bold;
        }
        .no-change {
            color: #6c757d;
        }
        .caja-display {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>‚ô†Ô∏è Poker Manager ‚ô£Ô∏è</h1>

    <div id="configSection">
        <h2>üí∞ Configuraci√≥n Inicial</h2>
        <div class="config-item">
            <span>Valor actual de la Caja:</span>
            <span id="cajaValueDisplay" class="caja-display">$100</span>
        </div>
        <div class="config-item">
            <label for="cajaValue">Nuevo Valor (Entero):</label>
            <input type="number" id="cajaValue" placeholder="Escribe un n√∫mero entero">
            <button class="btn btn-primary" onclick="window.updateCajaValue()">Actualizar Valor</button>
        </div>

        <h2>üë• Selecciona Jugadores</h2>
        <div id="playerSelection" class="player-list">
            </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-success" onclick="window.iniciarPartida()">üéÆ Iniciar Partida</button>
        </div>
    </div>

    <div id="gameSection" style="display:none;">
        <h2>üíµ Partida en Curso</h2>
        <div class="config-item">
            <span>Valor de la Caja:</span>
            <span id="cajaGameValueDisplay" class="caja-display"></span>
            <button class="btn btn-secondary" onclick="window.cambiarValorCaja()">Cambiar</button>
        </div>
        
        <h2>Activos:</h2>
        <div id="activePlayersList" class="player-list">
            </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-danger" onclick="window.finalizarJuego()">üèÅ Finalizar Juego</button>
        </div>
    </div>

    <div id="resultsSection" style="display:none;">
        <h2>üìä Resultados Finales</h2>
        <div id="resultsList">
            </div>
        <div id="sumCheck" style="margin-top: 15px; font-weight: bold;"></div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-warning" onclick="window.resetearJuego()">üîÑ Nueva Partida</button>
        </div>
    </div>

</div>

<script>
    // Variables globales para el estado del juego
    let cajaValue = 100; // Valor predeterminado
    let allPlayers = [
        { id: 1, name: 'Alice', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        { id: 2, name: 'Bob', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        { id: 3, name: 'Charlie', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        { id: 4, name: 'David', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        { id: 5, name: 'Eve', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        { id: 6, name: 'Frank', active: false, cajas: 0, initialFichas: 0, finalFichas: 0 },
        // Puedes agregar m√°s jugadores aqu√≠ si lo necesitas
    ];

    // --- FUNCIONES DE UTILIDAD Y CONFIGURACI√ìN ---

    function updateCajaValue() {
        const input = document.getElementById('cajaValue');
        const newValue = parseFloat(input.value);
        
        // Validaci√≥n: debe ser un n√∫mero entero mayor a 0
        if (newValue <= 0 || isNaN(newValue) || newValue % 1 !== 0) { 
            alert('‚ö†Ô∏è Por favor ingrese un valor de caja entero v√°lido mayor a 0');
            input.value = cajaValue; // Restaura el valor anterior
            return;
        }

        cajaValue = newValue;
        document.getElementById('cajaValueDisplay').textContent = `$${cajaValue}`;
        input.value = ''; // Limpia el input
    }

    function togglePlayer(id) {
        const player = allPlayers.find(p => p.id === id);
        if (player) {
            player.active = !player.active;
        }
        window.renderPlayerSelection(); // Uso de window. para evitar posibles errores
    }

    function renderPlayerSelection() {
        const container = document.getElementById('playerSelection');
        container.innerHTML = '';
        allPlayers.forEach(player => {
            const div = document.createElement('div');
            div.className = 'config-item';
            div.innerHTML = `
                <span>${player.name}</span>
                <input type="checkbox" ${player.active ? 'checked' : ''} onchange="window.togglePlayer(${player.id})">
            `;
            container.appendChild(div);
        });
    }

    // --- FUNCIONES DE JUEGO ---

    function iniciarPartida() {
        const activePlayers = allPlayers.filter(p => p.active);
        
        if (activePlayers.length < 2) {
            alert('‚ö†Ô∏è Debes seleccionar al menos 2 jugadores para iniciar la partida');
            return;
        }

        // 1. Ocultar Configuraci√≥n y Mostrar Juego
        document.getElementById('configSection').style.display = 'none';
        document.getElementById('gameSection').style.display = 'block';

        // 2. Mostrar el valor de la caja
        document.getElementById('cajaGameValueDisplay').textContent = `$${cajaValue}`;

        // 3. Reiniciar contadores para los activos
        allPlayers.forEach(player => {
            if (player.active) {
                player.cajas = 0;
                player.initialFichas = 0;
                player.finalFichas = 0;
            }
        });

        // 4. Renderizar la lista de jugadores activos
        window.renderActivePlayers();
    }

    function renderActivePlayers() {
        const container = document.getElementById('activePlayersList');
        container.innerHTML = '';

        allPlayers.filter(p => p.active).forEach(player => {
            const div = document.createElement('div');
            div.className = 'player-item';
            div.innerHTML = `
                <span>${player.name} (${player.cajas} Caja(s))</span>
                <div style="display:flex; gap: 10px; align-items:center;">
                    <span id="fichas-${player.id}" class="player-chips">${player.finalFichas || player.initialFichas}</span>
                    <button class="btn btn-primary" onclick="window.pedirCaja(${player.id})">+ Caja</button>
                    <button class="btn btn-secondary" onclick="window.actualizarFichas(${player.id})">Fichas Finales</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function pedirCaja(id) {
        const player = allPlayers.find(p => p.id === id);
        if (player) {
            player.cajas += 1;
            window.renderActivePlayers(); // Actualizar la lista
        }
    }

    function actualizarFichas(id) {
        const player = allPlayers.find(p => p.id === id);
        if (player) {
            let fichas = prompt(`Ingrese la cantidad de Fichas FINALES de ${player.name}:`);
            fichas = parseInt(fichas);

            if (isNaN(fichas) || fichas < 0) {
                alert('‚ö†Ô∏è Por favor ingrese un n√∫mero v√°lido mayor o igual a 0.');
                return;
            }
            player.finalFichas = fichas;
            window.renderActivePlayers(); // Actualizar la vista de fichas
        }
    }

    function cambiarValorCaja() {
        let nuevoValor = prompt(`Ingrese el nuevo valor de la caja (actual: $${cajaValue}):`);
        nuevoValor = parseInt(nuevoValor);

        if (isNaN(nuevoValor) || nuevoValor <= 0 || nuevoValor % 1 !== 0) {
            alert('‚ö†Ô∏è Por favor ingrese un valor de caja entero v√°lido mayor a 0.');
            return;
        }

        cajaValue = nuevoValor;
        document.getElementById('cajaGameValueDisplay').textContent = `$${cajaValue}`;
        alert(`‚úÖ Valor de la caja actualizado a $${cajaValue}`);
    }


    // --- FUNCIONES DE RESULTADOS ---

    function finalizarJuego() {
        const activePlayers = allPlayers.filter(p => p.active);

        // 1. Verificaci√≥n de Fichas
        const missingFichas = activePlayers.some(p => p.finalFichas === 0 && p.initialFichas === 0 && p.cajas > 0);
        if (missingFichas) {
            alert('‚ö†Ô∏è Debe ingresar la cantidad de fichas finales de TODOS los jugadores activos.');
            return;
        }

        // 2. Ocultar Juego y Mostrar Resultados
        document.getElementById('gameSection').style.display = 'none';
        document.getElementById('resultsSection').style.display = 'block';

        // 3. Calcular Resultados
        const results = activePlayers.map(player => {
            // G/P = Fichas finales - Cajas compradas
            const netCajas = player.finalFichas - player.cajas;
            const netMoney = netCajas * cajaValue;

            return {
                name: player.name,
                netCajas: netCajas,
                netMoney: netMoney
            };
        });

        // 4. Renderizar Resultados
        window.renderResults(results);
    }

    function renderResults(results) {
        const container = document.getElementById('resultsList');
        container.innerHTML = '';
        let sumTotal = 0;

        results.forEach(result => {
            const div = document.createElement('div');
            div.className = 'result-player';
            
            let statusClass, message;
            
            if (result.netMoney > 0) {
                statusClass = 'gain';
                message = `Gana: +$${Math.abs(result.netMoney)}`;
            } else if (result.netMoney < 0
